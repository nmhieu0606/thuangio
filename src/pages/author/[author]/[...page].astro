---
import { getCollection, CollectionEntry } from "astro:content";
import { toSlug } from "js/utils";
import Features from "@components/features.astro";
import Container from "@components/container.astro";
import Layout from "@layouts/Layout.astro";
import Pagination from "@components/Pagination.astro";
import Pagination2 from "@components/Pagination_2.astro";
import CategoryCloud from "@components/CategoryCloud.astro";
import { log } from "astro/dist/core/logger/core";
export async function getStaticPaths({ paginate }) {
  //const res=await fetch('http://localhost:1337/api/posts?populate=createdBy&[filters][createdBy][lastname]=Hi%E1%BA%BFu');
  const res = await fetch("http://127.0.0.1:1337/api/posts?populate=*");
  const allPosts = await res.json();
  const user = await fetch("http://127.0.0.1:1337/api/users");
  const allUsers = await user.json();
  const t = {
    data: allUsers,
  };

  return t.data.map((author) => {
    const filter = allPosts.data.filter(
      (p) => p.attributes.createdBy.data.attributes.username === author.username
    );

    return paginate(filter, {
      params: { author: author.username },
      pageSize: 3,
    });
  });
}
const { page } = Astro.props;
const img = page.data.map((item) => {
  return item.attributes.image;
});
const filter = img.filter((item) => {
  if (item.data != null) {
    return item.data;
  }
});

const temp = filter.map((item) => {
  return item.data.attributes;
});
---

<Layout title="blog">
  <Container>
    <div
      class="gap-4 grid sm:grid-cols-1 sm:gap-1 md:grid-cols-3 xl:grid-cols-3">
      {
        page.data.map((item) => (
          <Features
            href={`/blog/${item.attributes.slug}`}
            description={item.attributes.description}
            title={item.attributes.title}
            img={`http://127.0.0.1:1337${temp[0].url}`}
          />
        ))
      }
    </div>
    <div class="gird items-center text-center mt-5">
      <Pagination2 prev={page.url.prev} next={page.url.next} />
    </div>
    <CategoryCloud />
  </Container>
</Layout>
